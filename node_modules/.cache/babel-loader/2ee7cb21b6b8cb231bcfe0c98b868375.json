{"ast":null,"code":"import { BehaviorSubject } from 'rxjs';\nimport { history } from '../_helpers';\nimport { handleResponse } from '../_helpers';\nconst currentUserSubject = new BehaviorSubject(JSON.parse(localStorage.getItem('currentUser')));\nexport const authenticationService = {\n  login,\n  logout,\n  currentUser: currentUserSubject.asObservable(),\n\n  getOptions() {\n    return getOptions();\n  },\n\n  dni: getDni(),\n  token: getToken(),\n  userType: getUserType(),\n\n  get currentUserValue() {\n    return currentUserSubject.value;\n  },\n\n  apiurl: getApiUrl()\n};\n\nfunction getOptions() {\n  return {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': 'Bearer ' + getToken(),\n      'Access-Control-Allow-Origin': '*'\n    },\n    body: JSON.stringify({\n      \"dni\": getDni()\n    })\n  };\n}\n\nfunction getApiUrl() {\n  return 'http://192.168.1.131:8080';\n}\n\nfunction getDni() {\n  if (currentUserSubject.value != null) return currentUserSubject.value['dni'];\n  return \"\";\n}\n\nfunction getToken() {\n  if (currentUserSubject.value != null) return currentUserSubject.value['token'];\n  return \"\";\n}\n\nfunction getUserType() {\n  if (currentUserSubject.value != null) return currentUserSubject.value['userType'];\n  return \"\";\n}\n\nfunction login(username, password) {\n  const requestOptions = {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({\n      \"username\": username,\n      \"password\": password\n    })\n  };\n  return fetch(getApiUrl() + '/users/authenticate', requestOptions).then(handleResponse).then(user => {\n    if (user['error']) {\n      throw Error(user['error']);\n    }\n\n    localStorage.setItem('currentUser', JSON.stringify(user));\n    currentUserSubject.next(user);\n    return user;\n  });\n}\n\nfunction logout() {\n  localStorage.removeItem('currentUser');\n  currentUserSubject.next(null);\n  history.push('/login');\n}","map":{"version":3,"names":["BehaviorSubject","history","handleResponse","currentUserSubject","JSON","parse","localStorage","getItem","authenticationService","login","logout","currentUser","asObservable","getOptions","dni","getDni","token","getToken","userType","getUserType","currentUserValue","value","apiurl","getApiUrl","method","headers","body","stringify","username","password","requestOptions","fetch","then","user","Error","setItem","next","removeItem","push"],"sources":["I:/Facu/semiario2/workspace/predictivoUI/src/components/_services/authentication.service.js"],"sourcesContent":["import { BehaviorSubject } from 'rxjs';\r\nimport { history } from '../_helpers';\r\nimport { handleResponse } from '../_helpers';\r\n\r\nconst currentUserSubject = new BehaviorSubject(JSON.parse(localStorage.getItem('currentUser')));\r\n\r\nexport const authenticationService = {\r\n    login,\r\n    logout,\r\n    currentUser: currentUserSubject.asObservable(),\r\n\tgetOptions() { return getOptions() },\r\n\tdni: getDni(),\r\n\ttoken: getToken(),\r\n\tuserType: getUserType(),\r\n    get currentUserValue () { return currentUserSubject.value },\r\n\tapiurl: getApiUrl()\r\n};\r\n\r\nfunction getOptions() {\r\n\treturn {\r\n        method: 'POST',\r\n        headers: {\r\n\t\t\t'Content-Type': 'application/json',\r\n\t\t\t'Authorization': 'Bearer ' + getToken(),\r\n\t\t\t'Access-Control-Allow-Origin': '*'\r\n\t\t},\r\n        body: JSON.stringify({ \"dni\": getDni()})\r\n    };\r\n}\r\n\r\nfunction getApiUrl(){\r\n\treturn 'http://192.168.1.131:8080';\r\n}\r\n\r\nfunction getDni() {\r\n\tif (currentUserSubject.value != null) \r\n\t\treturn currentUserSubject.value['dni'];\r\n\treturn \"\";\r\n}\r\n\r\nfunction getToken() {\r\n\tif (currentUserSubject.value != null) \r\n\t\treturn currentUserSubject.value['token'];\r\n\treturn \"\";\r\n}\r\n\r\nfunction getUserType() {\r\n\tif (currentUserSubject.value != null) \r\n\t\treturn currentUserSubject.value['userType'];\r\n\treturn \"\";\r\n}\r\n\r\n\r\nfunction login(username, password) {\r\n    const requestOptions = {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ \"username\": username, \"password\": password })\r\n    };\r\n\r\n    return fetch(getApiUrl() + '/users/authenticate', requestOptions)\r\n        .then(handleResponse)\r\n        .then(user => {\r\n\t\t\tif (user['error']) {\r\n\t\t\t\tthrow Error(user['error']); \r\n\t\t\t}\r\n            localStorage.setItem('currentUser', JSON.stringify(user));\r\n            currentUserSubject.next(user);\r\n            return user;\r\n        });\r\n}\r\n\r\nfunction logout() {\r\n    localStorage.removeItem('currentUser');\r\n    currentUserSubject.next(null);\r\n\thistory.push('/login');\r\n}"],"mappings":"AAAA,SAASA,eAAT,QAAgC,MAAhC;AACA,SAASC,OAAT,QAAwB,aAAxB;AACA,SAASC,cAAT,QAA+B,aAA/B;AAEA,MAAMC,kBAAkB,GAAG,IAAIH,eAAJ,CAAoBI,IAAI,CAACC,KAAL,CAAWC,YAAY,CAACC,OAAb,CAAqB,aAArB,CAAX,CAApB,CAA3B;AAEA,OAAO,MAAMC,qBAAqB,GAAG;EACjCC,KADiC;EAEjCC,MAFiC;EAGjCC,WAAW,EAAER,kBAAkB,CAACS,YAAnB,EAHoB;;EAIpCC,UAAU,GAAG;IAAE,OAAOA,UAAU,EAAjB;EAAqB,CAJA;;EAKpCC,GAAG,EAAEC,MAAM,EALyB;EAMpCC,KAAK,EAAEC,QAAQ,EANqB;EAOpCC,QAAQ,EAAEC,WAAW,EAPe;;EAQjC,IAAIC,gBAAJ,GAAwB;IAAE,OAAOjB,kBAAkB,CAACkB,KAA1B;EAAiC,CAR1B;;EASpCC,MAAM,EAAEC,SAAS;AATmB,CAA9B;;AAYP,SAASV,UAAT,GAAsB;EACrB,OAAO;IACAW,MAAM,EAAE,MADR;IAEAC,OAAO,EAAE;MACd,gBAAgB,kBADF;MAEd,iBAAiB,YAAYR,QAAQ,EAFvB;MAGd,+BAA+B;IAHjB,CAFT;IAOAS,IAAI,EAAEtB,IAAI,CAACuB,SAAL,CAAe;MAAE,OAAOZ,MAAM;IAAf,CAAf;EAPN,CAAP;AASA;;AAED,SAASQ,SAAT,GAAoB;EACnB,OAAO,2BAAP;AACA;;AAED,SAASR,MAAT,GAAkB;EACjB,IAAIZ,kBAAkB,CAACkB,KAAnB,IAA4B,IAAhC,EACC,OAAOlB,kBAAkB,CAACkB,KAAnB,CAAyB,KAAzB,CAAP;EACD,OAAO,EAAP;AACA;;AAED,SAASJ,QAAT,GAAoB;EACnB,IAAId,kBAAkB,CAACkB,KAAnB,IAA4B,IAAhC,EACC,OAAOlB,kBAAkB,CAACkB,KAAnB,CAAyB,OAAzB,CAAP;EACD,OAAO,EAAP;AACA;;AAED,SAASF,WAAT,GAAuB;EACtB,IAAIhB,kBAAkB,CAACkB,KAAnB,IAA4B,IAAhC,EACC,OAAOlB,kBAAkB,CAACkB,KAAnB,CAAyB,UAAzB,CAAP;EACD,OAAO,EAAP;AACA;;AAGD,SAASZ,KAAT,CAAemB,QAAf,EAAyBC,QAAzB,EAAmC;EAC/B,MAAMC,cAAc,GAAG;IACnBN,MAAM,EAAE,MADW;IAEnBC,OAAO,EAAE;MAAE,gBAAgB;IAAlB,CAFU;IAGnBC,IAAI,EAAEtB,IAAI,CAACuB,SAAL,CAAe;MAAE,YAAYC,QAAd;MAAwB,YAAYC;IAApC,CAAf;EAHa,CAAvB;EAMA,OAAOE,KAAK,CAACR,SAAS,KAAK,qBAAf,EAAsCO,cAAtC,CAAL,CACFE,IADE,CACG9B,cADH,EAEF8B,IAFE,CAEGC,IAAI,IAAI;IACnB,IAAIA,IAAI,CAAC,OAAD,CAAR,EAAmB;MAClB,MAAMC,KAAK,CAACD,IAAI,CAAC,OAAD,CAAL,CAAX;IACA;;IACQ3B,YAAY,CAAC6B,OAAb,CAAqB,aAArB,EAAoC/B,IAAI,CAACuB,SAAL,CAAeM,IAAf,CAApC;IACA9B,kBAAkB,CAACiC,IAAnB,CAAwBH,IAAxB;IACA,OAAOA,IAAP;EACH,CATE,CAAP;AAUH;;AAED,SAASvB,MAAT,GAAkB;EACdJ,YAAY,CAAC+B,UAAb,CAAwB,aAAxB;EACAlC,kBAAkB,CAACiC,IAAnB,CAAwB,IAAxB;EACHnC,OAAO,CAACqC,IAAR,CAAa,QAAb;AACA"},"metadata":{},"sourceType":"module"}