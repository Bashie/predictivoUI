{"ast":null,"code":"import{BehaviorSubject}from'rxjs';import{history}from'../_helpers';import{handleResponse}from'../_helpers';var currentUserSubject=new BehaviorSubject(JSON.parse(localStorage.getItem('currentUser')));export var authenticationService={login:login,logout:logout,currentUser:currentUserSubject.asObservable(),getOptions:function getOptions(){return _getOptions();},dni:getDni(),token:getToken(),userType:getUserType(),get currentUserValue(){return currentUserSubject.value;},apiurl:getApiUrl()};function _getOptions(){return{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+getToken(),'Access-Control-Allow-Origin':'*'},body:JSON.stringify({\"dni\":getDni()})};}function getApiUrl(){return'http://192.168.1.131:8080';}function getDni(){if(currentUserSubject.value!=null)return currentUserSubject.value['dni'];return\"\";}function getToken(){if(currentUserSubject.value!=null)return currentUserSubject.value['token'];return\"\";}function getUserType(){if(currentUserSubject.value!=null)return currentUserSubject.value['userType'];return\"\";}function login(username,password){var requestOptions={method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({\"username\":username,\"password\":password})};return fetch(getApiUrl()+'/users/authenticate',requestOptions).then(handleResponse).then(function(user){if(user['error']){throw Error(user['error']);}localStorage.setItem('currentUser',JSON.stringify(user));currentUserSubject.next(user);return user;});}function logout(){localStorage.removeItem('currentUser');currentUserSubject.next(null);history.push('/login');}","map":{"version":3,"names":["BehaviorSubject","history","handleResponse","currentUserSubject","JSON","parse","localStorage","getItem","authenticationService","login","logout","currentUser","asObservable","getOptions","dni","getDni","token","getToken","userType","getUserType","currentUserValue","value","apiurl","getApiUrl","method","headers","body","stringify","username","password","requestOptions","fetch","then","user","Error","setItem","next","removeItem","push"],"sources":["I:/Facu/semiario2/workspace/predictivoUI/src/components/_services/authentication.service.js"],"sourcesContent":["import { BehaviorSubject } from 'rxjs';\r\nimport { history } from '../_helpers';\r\nimport { handleResponse } from '../_helpers';\r\n\r\nconst currentUserSubject = new BehaviorSubject(JSON.parse(localStorage.getItem('currentUser')));\r\n\r\nexport const authenticationService = {\r\n    login,\r\n    logout,\r\n    currentUser: currentUserSubject.asObservable(),\r\n\tgetOptions() { return getOptions() },\r\n\tdni: getDni(),\r\n\ttoken: getToken(),\r\n\tuserType: getUserType(),\r\n    get currentUserValue () { return currentUserSubject.value },\r\n\tapiurl: getApiUrl()\r\n};\r\n\r\nfunction getOptions() {\r\n\treturn {\r\n        method: 'POST',\r\n        headers: {\r\n\t\t\t'Content-Type': 'application/json',\r\n\t\t\t'Authorization': 'Bearer ' + getToken(),\r\n\t\t\t'Access-Control-Allow-Origin': '*'\r\n\t\t},\r\n        body: JSON.stringify({ \"dni\": getDni()})\r\n    };\r\n}\r\n\r\nfunction getApiUrl(){\r\n\treturn 'http://192.168.1.131:8080';\r\n}\r\n\r\nfunction getDni() {\r\n\tif (currentUserSubject.value != null) \r\n\t\treturn currentUserSubject.value['dni'];\r\n\treturn \"\";\r\n}\r\n\r\nfunction getToken() {\r\n\tif (currentUserSubject.value != null) \r\n\t\treturn currentUserSubject.value['token'];\r\n\treturn \"\";\r\n}\r\n\r\nfunction getUserType() {\r\n\tif (currentUserSubject.value != null) \r\n\t\treturn currentUserSubject.value['userType'];\r\n\treturn \"\";\r\n}\r\n\r\n\r\nfunction login(username, password) {\r\n    const requestOptions = {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ \"username\": username, \"password\": password })\r\n    };\r\n\r\n    return fetch(getApiUrl() + '/users/authenticate', requestOptions)\r\n        .then(handleResponse)\r\n        .then(user => {\r\n\t\t\tif (user['error']) {\r\n\t\t\t\tthrow Error(user['error']); \r\n\t\t\t}\r\n            localStorage.setItem('currentUser', JSON.stringify(user));\r\n            currentUserSubject.next(user);\r\n            return user;\r\n        });\r\n}\r\n\r\nfunction logout() {\r\n    localStorage.removeItem('currentUser');\r\n    currentUserSubject.next(null);\r\n\thistory.push('/login');\r\n}"],"mappings":"AAAA,OAASA,eAAT,KAAgC,MAAhC,CACA,OAASC,OAAT,KAAwB,aAAxB,CACA,OAASC,cAAT,KAA+B,aAA/B,CAEA,GAAMC,mBAAkB,CAAG,GAAIH,gBAAJ,CAAoBI,IAAI,CAACC,KAAL,CAAWC,YAAY,CAACC,OAAb,CAAqB,aAArB,CAAX,CAApB,CAA3B,CAEA,MAAO,IAAMC,sBAAqB,CAAG,CACjCC,KAAK,CAALA,KADiC,CAEjCC,MAAM,CAANA,MAFiC,CAGjCC,WAAW,CAAER,kBAAkB,CAACS,YAAnB,EAHoB,CAIpCC,UAJoC,sBAIvB,CAAE,MAAOA,YAAU,EAAjB,CAAqB,CAJA,CAKpCC,GAAG,CAAEC,MAAM,EALyB,CAMpCC,KAAK,CAAEC,QAAQ,EANqB,CAOpCC,QAAQ,CAAEC,WAAW,EAPe,CAQjC,GAAIC,iBAAJ,EAAwB,CAAE,MAAOjB,mBAAkB,CAACkB,KAA1B,CAAiC,CAR1B,CASpCC,MAAM,CAAEC,SAAS,EATmB,CAA9B,CAYP,QAASV,YAAT,EAAsB,CACrB,MAAO,CACAW,MAAM,CAAE,MADR,CAEAC,OAAO,CAAE,CACd,eAAgB,kBADF,CAEd,gBAAiB,UAAYR,QAAQ,EAFvB,CAGd,8BAA+B,GAHjB,CAFT,CAOAS,IAAI,CAAEtB,IAAI,CAACuB,SAAL,CAAe,CAAE,MAAOZ,MAAM,EAAf,CAAf,CAPN,CAAP,CASA,CAED,QAASQ,UAAT,EAAoB,CACnB,MAAO,2BAAP,CACA,CAED,QAASR,OAAT,EAAkB,CACjB,GAAIZ,kBAAkB,CAACkB,KAAnB,EAA4B,IAAhC,CACC,MAAOlB,mBAAkB,CAACkB,KAAnB,CAAyB,KAAzB,CAAP,CACD,MAAO,EAAP,CACA,CAED,QAASJ,SAAT,EAAoB,CACnB,GAAId,kBAAkB,CAACkB,KAAnB,EAA4B,IAAhC,CACC,MAAOlB,mBAAkB,CAACkB,KAAnB,CAAyB,OAAzB,CAAP,CACD,MAAO,EAAP,CACA,CAED,QAASF,YAAT,EAAuB,CACtB,GAAIhB,kBAAkB,CAACkB,KAAnB,EAA4B,IAAhC,CACC,MAAOlB,mBAAkB,CAACkB,KAAnB,CAAyB,UAAzB,CAAP,CACD,MAAO,EAAP,CACA,CAGD,QAASZ,MAAT,CAAemB,QAAf,CAAyBC,QAAzB,CAAmC,CAC/B,GAAMC,eAAc,CAAG,CACnBN,MAAM,CAAE,MADW,CAEnBC,OAAO,CAAE,CAAE,eAAgB,kBAAlB,CAFU,CAGnBC,IAAI,CAAEtB,IAAI,CAACuB,SAAL,CAAe,CAAE,WAAYC,QAAd,CAAwB,WAAYC,QAApC,CAAf,CAHa,CAAvB,CAMA,MAAOE,MAAK,CAACR,SAAS,GAAK,qBAAf,CAAsCO,cAAtC,CAAL,CACFE,IADE,CACG9B,cADH,EAEF8B,IAFE,CAEG,SAAAC,IAAI,CAAI,CACnB,GAAIA,IAAI,CAAC,OAAD,CAAR,CAAmB,CAClB,KAAMC,MAAK,CAACD,IAAI,CAAC,OAAD,CAAL,CAAX,CACA,CACQ3B,YAAY,CAAC6B,OAAb,CAAqB,aAArB,CAAoC/B,IAAI,CAACuB,SAAL,CAAeM,IAAf,CAApC,EACA9B,kBAAkB,CAACiC,IAAnB,CAAwBH,IAAxB,EACA,MAAOA,KAAP,CACH,CATE,CAAP,CAUH,CAED,QAASvB,OAAT,EAAkB,CACdJ,YAAY,CAAC+B,UAAb,CAAwB,aAAxB,EACAlC,kBAAkB,CAACiC,IAAnB,CAAwB,IAAxB,EACHnC,OAAO,CAACqC,IAAR,CAAa,QAAb,EACA"},"metadata":{},"sourceType":"module"}